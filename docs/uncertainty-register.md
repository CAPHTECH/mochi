# 不確実性台帳（Uncertainty Register）

## Decision Frame

| 項目 | 内容 |
|------|------|
| **Decision** | Mochi（ドメイン特化型SLM生成システム）の開発を進めるべきか、どのような方向性で進めるか |
| **Stakes** | 開発工数の投資、技術的アプローチが根本的に間違っていた場合の手戻り |
| **Constraints** | 個人/小規模チーム開発、GPU計算リソースの制約 |

---

## Uncertainty Register

| ID | 不確実性（疑問文） | カテゴリ | Status | Evidence |
|----|-------------------|---------|--------|----------|
| U1 | ファインチューニングでプロジェクト固有のコーディングパターンを本当に学習できるか？ | 技術-学習 | Open | - |
| U2 | 小規模プロジェクト（10kLOC以下）で十分な学習データ量を確保できるか？ | 技術-データ | Open | - |
| U3 | 生成したSLMはLLM補助として実用的な精度を出せるか？ | 技術-品質 | Open | - |
| U4 | RAGではなくファインチューニングを選ぶ優位性は十分か？ | 設計判断 | Open | - |
| U5 | 学習データの品質をどう自動的に担保できるか？ | 技術-品質 | Open | - |
| U6 | SLM→LLM連携の最適なパターンは何か？ | 設計判断 | Open | - |
| U7 | 継続学習でモデルが劣化（catastrophic forgetting）しないか？ | 技術-運用 | Open | - |
| U8 | 実用的なユースケースを持つターゲットユーザーは存在するか？ | 市場 | **Validated** | 自分自身がユーザー |
| U9 | 既存ツール（Copilot/Cursor/Cody）との差別化ポイントは明確か？ | 市場 | Open | - |
| U10 | 個人開発者が許容できるGPU学習コスト内に収まるか？ | リソース | Open | - |

### Status定義
- **Open**: 未検証
- **Validated**: 仮定が正しいと確認された
- **Rejected**: 仮定が誤りと判明
- **Accepted**: リスクとして受容（観測せず進む）

---

## Priority Ranking

| Rank | ID | 不確実性 | Priority Score | 理由 |
|------|----|---------|--------------:|------|
| 1 | U8 | ユーザーニーズの存在 | 40.0 | 市場がなければ全て無意味 |
| 2 | U1 | 学習可能性 | 33.3 | 技術的実現性の根幹 |
| 3 | U3 | 実用精度 | 26.7 | 価値提案の核心 |
| 4 | U2 | データ量の十分性 | 21.3 | 小規模プロジェクト対応に影響 |
| 5 | U5 | データ品質担保 | 18.0 | 学習結果の品質に直結 |
| 5 | U9 | 差別化ポイント | 18.0 | 競争優位性 |
| 7 | U4 | RAG vs Fine-tuning | 15.0 | アーキテクチャ選択 |
| 8 | U10 | GPU学習コスト | 13.5 | ターゲット層に影響 |
| 9 | U6 | 連携パターン | 8.0 | 後からでも変更可能 |
| 10 | U7 | 継続学習の劣化 | 4.5 | Phase 3以降の問題 |

### スコア計算式
```
Priority = Impact × (6 - Evidence) × Urgency ÷ Effort

- Impact: 影響度 (1-5)
- Evidence: 根拠の強さ (1-5、低いほど不確実)
- Urgency: 緊急度 (1-5)
- Effort: 観測コスト (1-5)
```

---

## Observation Tasks

### ~~OBS-1: ユーザーニーズ検証~~ (スキップ)

**対象**: U8（ターゲットユーザーの存在）

| 項目 | 内容 |
|------|------|
| **Status** | **Skipped** |
| **Result** | 開発者自身がユーザーであり、ニーズは明確。外部検証不要。 |

---

### OBS-2: 学習可能性のPoC

**対象**: U1（ファインチューニングでの学習可能性）

| 項目 | 内容 |
|------|------|
| **Hypothesis** | Qwen2.5-Coder-1.5BをQLoRAでファインチューニングすることで、特定プロジェクトのコーディングパターン（命名規則、API使用法、アーキテクチャパターン）を学習できる |
| **Target Project** | [CAPHTECH/kiri](https://github.com/CAPHTECH/kiri) - MCP Server for code context extraction |
| **Project Stats** | TypeScript 97.3%, src/ ~27kLOC, tests/ ~26kLOC, docs/ ~6.6k lines, 578 commits |
| **Method** | 1. kiriリポジトリをクローン<br>2. 基本的なデータパイプライン（コードチャンク化→Alpaca形式）を実装<br>3. Qwen2.5-Coder-1.5BをQLoRAで学習（1-2エポック）<br>4. kiri固有の補完タスクで評価（ベースモデルと比較） |
| **Timebox** | 5日 |
| **Decision Rule** | **採用**: プロジェクト固有タスクでベースモデルより10%以上の改善<br>**部分採用**: 改善は見られるが10%未満（データ/手法の改善余地あり）<br>**棄却**: 改善なし、または劣化 |
| **Evidence** | 学習スクリプト、評価結果（Perplexity、手動評価）、生成サンプル比較 |
| **Status** | Not Started |
| **Result** | - |

---

### OBS-3: 実用精度の評価

**対象**: U3（LLM補助としての実用性）

| 項目 | 内容 |
|------|------|
| **Hypothesis** | ファインチューニングしたSLMをLLMのコンテキストとして使うことで、LLM単体よりプロジェクト適合度の高いコードを生成できる |
| **Method** | 1. OBS-2で学習したSLMを使用<br>2. 評価タスクセット作成（関数補完10件、バグ修正5件、新機能追加5件）<br>3. 3パターンで比較: A) LLM単体、B) LLM + RAG、C) LLM + SLMコンテキスト強化<br>4. 人間評価（正確性、規約準拠度、実用性を5点評価） |
| **Timebox** | 3日（OBS-2完了後） |
| **Decision Rule** | **採用**: パターンCが平均スコアでA,Bを上回る<br>**方向転換**: Bが最も良い場合はRAGベースに変更を検討<br>**棄却**: Aが最も良い場合はアプローチ自体を再考 |
| **Evidence** | 評価タスクセット、各パターンの生成結果、スコアシート |
| **Status** | Not Started |
| **Result** | - |

---

### OBS-4: データ量下限の検証

**対象**: U2（小規模プロジェクトでのデータ量）

| 項目 | 内容 |
|------|------|
| **Hypothesis** | 5kLOC程度の小規模プロジェクトでも、合成データ生成と組み合わせることで有効な学習が可能 |
| **Method** | 1. 小規模プロジェクト（3-5kLOC）を選定<br>2. 生データのみで学習 vs 合成データ（LLMでQ&A生成）追加で学習<br>3. 同一評価タスクで比較 |
| **Timebox** | 3日（OBS-2と並行可能） |
| **Decision Rule** | **採用**: 合成データ追加で有意な改善（5%以上）<br>**条件付き採用**: 改善あるが小規模プロジェクトには限界（制約として記載）<br>**棄却**: 小規模では学習効果なし |
| **Evidence** | データ量別の学習曲線、評価結果比較 |
| **Status** | Not Started |
| **Result** | - |

---

## Execution Schedule

```
Week 1:
├─ OBS-2: 学習可能性PoC ─────────────────────┐
│                                            │
└─ OBS-4: データ量下限検証（並行可能）────────┤
                                             │
Week 2:                                      ▼
└─ OBS-3: 実用精度評価 ←─────────(OBS-2完了後)
                                             │
                                             ▼
                              Go/No-Go 判断ポイント

※ OBS-1はスキップ（自分がユーザー）
```

## Go/No-Go Criteria

| 観測結果 | 判断 |
|---------|------|
| OBS-2 採用 + OBS-3 採用 | **Go**: 本格開発開始 |
| OBS-2 部分採用 | **Go（要調整）**: データ戦略を強化して進む |
| OBS-3 で B(RAG) が最良 | **方向転換**: RAGベースアーキテクチャに変更 |
| OBS-2 棄却 | **No-Go**: 技術的実現性なし |

---

## Assumptions（検証せずに進む仮定）

以下は現時点でリスクとして受容し、検証せずに進む：

| 仮定 | 理由 |
|------|------|
| Qwen2.5-Coderは日本語対応が良好 | 公開ベンチマークで確認済み |
| QLoRAは品質を大きく損なわない | 多数の研究で実証済み |
| Ollamaでのデプロイは技術的に問題ない | 既存事例多数 |

---

## Change Log

| 日付 | 変更内容 |
|------|---------|
| 2026-01-10 | 初版作成、U1-U10を特定、OBS-1〜4を設計 |
| 2026-01-10 | U8をValidated（自分がユーザー）、OBS-1をスキップ |
| 2026-01-10 | OBS-2の対象プロジェクトをCAPHTECH/kiriに確定 |
